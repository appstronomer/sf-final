# SfFinal

Данный проект является итоговым проектом курса. 

## Запуск

### Разработка
```sh
docker compose -f compose.dev.yml up
```
Запуск варианта для разрабтки. В этом режиме не создаётся отдельный образ, а исходный 
код доставляется через volume. Кроме того, сохраняется кеш и все загруженные
зависимости. Этим вариантом удобно перезапускать сервисы во время разработки.

### Боевой
```sh
docker compose -f compose.prod.yml up
```
Запуск боевого варианта. Сборка проходит в два этапа - поэтому приложение имеет 
минимальный размер. Однако, кеш на жестком диске хостовой системы не сохранется - 
поэтому повторная сборка потребует снова загрузить все пакеты и собрать все юниты с 
нуля.


## Структура проекта
`aux` - юниты, не относящиеся к работе приложения, но использующиеся при запуске dev-варианта.  
`aux/mock-rss-backend` - исходный код, конфиги и кеш, относящийся к работе минимального сервера RSS, из 
которого сервер новостей читает в dev-режиме.  
`app` - юниты, необходимые для корректной работы приложения.  
`app/check-backend` - исходный код, конфиги и артефакты, относящиеся к работе сервиса цензурирования.  
`app/news-backend` - исходный код, конфиги и кеш, относящийся к работе бекенда сервиса новостей.  
`app/news-db` - структура и хранилище, относящиеся к работе базы данных сервиса новостей.  
`app/comments-backend` - исходный код, конфиги и кеш, относящийся к работе бекенда сервиса комментариев.  
`app/comments-db` - структура и хранилище, относящиеся к работе базы данных сервиса комментариев.  
`app/gateway-backend` - исходный код, конфиги и кеш, относящийся к работе API Gateway.  


## Структура юнита
Все юниты, перечисленные ранее, имеют подобную структуру:  
  
`source` - исходный код юнита, который однозначно необходимо версионировать.
Для базы данных это `*.sql`-файл со структурой. Так же здесь находятся `Dockerfile`ы,
если они характерны для юнита.  
  
`config.*` - настроечные файлы, необходимые для запуска боевого `prod` варианта юнита или 
варианта для разработки `dev`. Конфиги для запуска в режиме `dev` должны весионироваться
для облегчения доставки кода, а конфиги для запуска `prod` - не должны. Однако, для 
облегчения работы с проектом и ввиду того, что проект учебный, дирректория `config.prod`
так же находится под системой контроля версий.  
  
`volume.*` - файлы, сгенерированные юнитом в боевом режиме `prod` и в режиме разработки
`dev`. Здесь может находиться как хранилище базы данных, так и кеш бекенда/фронтенда.
Файлы в этой дирректори не версионируются.
